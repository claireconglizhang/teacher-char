---
title: "The effects of teacher human capital characteristics"
output: html_document
date: '2022-09-28'
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      include = FALSE,
                      message = FALSE)
pacman::p_load(tidyverse, janitor, rio, here, gtsummary, modelsummary, stargazer, huxtable, lfe, lubridate, psych)
```


```{r, functions}
`%!in%` <- Negate(`%in%`)

percentage <- function(x){
  paste(round(100*x, 2), "%", sep="")
}

round3 <- function(x){
  paste(round(x, digits = 3))
}

nmlz <- function(x){
  x = (x-mean(x, na.rm = TRUE))/sd(x, na.rm = TRUE)
  x
}

na_percentage <- function(x){
  y = sum(is.na(x))/length(x)
  paste(round(100*y, 2), "%", sep="")
}

mymean = function(x){
  x = combn(rev(x), n()-1, FUN = mean, na.rm = TRUE)
  x
}
```


```{r}
schid_full <- rio::import(here::here("data", "schid_full.csv"))
schid_random <- rio::import(here::here("data", "schid_random.csv"))
schid_nosorting <- rio::import(here::here("data", "schid_nosorting.csv"))
schid_nochange <- rio::import(here::here("data", "schid_nochange.csv"))
schid_nochange_2cls <- rio::import(here::here("data", "schid_nochange_2cls.csv"))

full_stu_1 <- rio::import(here::here("data", "cepsw1studentEN.dta")) 
full_stu_2 <- rio::import(here::here("data", "cepsw2studentEN.dta")) 
# w2status, followed-up = 1, missing = 2, newcomer = 3
full_stu <- inner_join(full_stu_1, full_stu_2) %>% ungroup() %>% filter(w2status == 1)

full_tch_1 <- rio::import(here::here("data", "cepsw1teacherEN.dta")) %>% filter(grade9 == 0)
full_tch_2 <- rio::import(here::here("data", "cepsw2teacherEN.dta"))
```

#### Outcomes of interest

 - Student academic performance (score)
 - Student academic confidence (conf)
 
```{r, student variables}
stu_var <- full_stu %>% 
  select(ids,
         schids,
         clsids,
         w2clsids,
         fall,
         mat = w2mat, # raw score
         chn = w2chn, # raw score
         eng = w2eng, # raw score
         cog = w2cog3pl, # CEPS standardized, score/mean = 0, sd = 1
         mat1 = stdmat, # CEPS standardized score/mean = 70, sd = 10
         chn1 = stdchn, # CEPS standardized score/mean = 70, sd = 10
         eng1 = stdeng, # CEPS standardized score/mean = 70, sd = 10
         cog1 = cog3pl, # CEPS standardized score/mean = 0, sd = 1
         female = stsex,
         birthyear= a02a, #some birthyear are coded as 2020, which may be a typo for 2002, swap 2020 for 2002 
         birthmonth = a02b, #some birthmonth are missing, recode 1 for NA
         only = stonly,
         rural = sthktype, 
         migrant = stmigrant, 
         medu = stmedu, 
         fedu = stfedu,
         income = steco_3c,
         matconf = w2b02,
         chnconf = w2b03,
         engconf = w2b04) %>% 
  mutate(birthyear = ifelse(birthyear == 2020, 2002, birthyear),
         birthmonth = ifelse(is.na(birthmonth), 1, birthmonth)) %>% 
  mutate(birth = ym(paste(birthyear, birthmonth, sep = "-")),
         entry = ym("2013-9"),
         age = floor(decimal_date(entry) - decimal_date(birth)), 
         female = recode(female, '1' = 0, '0' = 1),
         only = recode(only,'1' = 1, '2' = 0),
         migrant = recode(migrant,'1' = 0, '2' = 1, '3' = 1),
         medu = recode(medu, '1' = 0, '2' = 6, '3' = 9, '4' = 12, '5' = 12, '6' = 12, '7' = 14, '8' = 16, '9' = 19),
         fedu = recode(fedu, '1' = 0, '2' = 6, '3' = 9, '4' = 12, '5' = 12, '6' = 12, '7' = 14, '8' = 16, '9' = 19),
         income = recode(income, '1' = 0, '2' = 1, '3' = 2),
         mat1 = (mat1-70)/10,
         chn1 = (chn1-70)/10,
         eng1 = (eng1-70)/10,
         matconf = recode(matconf,'1' = 0, '2' = 1, '3' = 2, '4' = 3),
         chnconf = recode(chnconf,'1' = 0, '2' = 1, '3' = 2, '4' = 3),
         engconf = recode(engconf,'1' = 0, '2' = 1, '3' = 2, '4' = 3)) %>% 
  group_by(schids) %>% 
  mutate(chn = nmlz(chn),
         eng = nmlz(eng),
         mat = nmlz(mat),
         chnconf = nmlz(chnconf),
         engconf = nmlz(engconf),
         matconf = nmlz(matconf)) %>% 
  ungroup() %>% 
  group_by(clsids) %>% 
  mutate(hrsize = n(),
         hrfemale = mymean(female),
         hrage = mymean(age),
         hronly = mymean(only),
         hrrural = mymean(rural),
         hrmigrant = mymean(migrant),
         hrmedu = mymean(medu),
         hrfedu = mymean(fedu),
         hrincome = mymean(income)) %>% 
  ungroup() 
```


### Teacher human capital characteristics of interest 

 - Educational background 
   - years of education (tchedu)
   - graduate degree - master's and above (tchgrad) 
   - education major (tchmajor) 
 - Teaching experience
   - years of teaching (tchexp)
   - 1-2 years (tchexp1)
   - 3-4 years (tchexp2)
   - 5-9 years (tchexp3)
   - 10-14 years (tchexp4)
   - 15-24 years (tchexp5)
   - 25+ years (tchexp6)

 
```{r}
tch_var <- full_tch_2 %>% 
  select(schids,
         w2clsids,
         tchids,
         advisor = w2tchhr,
         subject = w2tchsubject,
         tchfemale = w2tchc01,
         tchexp = w2tchc08,
         tchedu = w2tchc04, 
         tchmajor = w2tchc05) %>% 
  mutate(tchfemale = recode(tchfemale, '2' = 1, '1' = 0),
         tchedu = recode(tchedu, '1' = 9, '2' = 12, '3' = 12, '4' = 14, '5' = 16, '6' = 16, '7' = 19)) %>% 
  group_by(schadvisor = mymean(advisor), # need these only for dealing with missing data purpose
           schexp = mymean(tchexp), 
           schedu = mymean(tchedu)) %>% 
  ungroup()

tch_var_chn <- tch_var %>% filter(subject == 2) 
tch_var_eng <- tch_var %>% filter(subject == 3)
tch_var_mat <- tch_var %>% filter(subject == 1)
```


```{r match students with teachers}
chn_full <- left_join(stu_var, tch_var_chn) %>% 
  ungroup()  %>% 
  mutate(match = ifelse(female == tchfemale, 1, 0)) %>% 
  select(ids, clsids, w2clsids, schids, fall, match,
         score = chn, 
         conf = chnconf, 
         cog, chn1, eng1, mat1, cog1, female, age, only, rural, migrant, medu, fedu, income,
         tchfemale, advisor, tchexp, tchedu,
         hrsize, hrfemale, hrage, hronly, hrrural, hrmigrant, hrmedu, hrfedu, hrincome,
         schadvisor, schexp, schedu)

eng_full <- left_join(stu_var, tch_var_eng) %>% 
  ungroup()  %>% 
  mutate(match = ifelse(female == tchfemale, 1, 0)) %>% 
  select(ids, clsids, w2clsids, schids, fall, match,
         score = eng, 
         conf = engconf, 
         cog, chn1, eng1, mat1, cog1, female, age, only, rural, migrant, medu, fedu, income,
         tchfemale, advisor, tchexp, tchedu,
         hrsize, hrfemale, hrage, hronly, hrrural, hrmigrant, hrmedu, hrfedu, hrincome,
         schadvisor, schexp, schedu)

mat_full <- left_join(stu_var, tch_var_mat) %>% 
  ungroup()  %>% 
  mutate(match = ifelse(female == tchfemale, 1, 0)) %>% 
  select(ids, clsids, w2clsids, schids, fall, match,
         score = mat, 
         conf = matconf, 
         cog, chn1, eng1, mat1, cog1, female, age, only, rural, migrant, medu, fedu, income,
         tchfemale, advisor, tchexp, tchedu,
         hrsize, hrfemale, hrage, hronly, hrrural, hrmigrant, hrmedu, hrfedu, hrincome,
         schadvisor, schexp, schedu)
```


```{r}
chn0 <- right_join(chn_full, schid_random) %>% ungroup() # for robustness check
eng0 <- right_join(eng_full, schid_random) %>% ungroup()
mat0 <- right_join(mat_full, schid_random) %>% ungroup()

chn0 <- right_join(chn_full, schid_nosorting) %>% ungroup() # for main analysis
eng0 <- right_join(eng_full, schid_nosorting) %>% ungroup()
mat0 <- right_join(mat_full, schid_nosorting) %>% ungroup()
```

### Missing data

```{r, include = TRUE}
apply(chn0, 2, na_percentage)
apply(eng0, 2, na_percentage)
apply(mat0, 2, na_percentage)
```


```{r}
# drop incomplete observations on predictor and outcome variables
chn <- chn0 %>% drop_na(c(score, conf, match, cog, cog1, chn1, eng1, mat1))
eng <- eng0 %>% drop_na(c(score, conf, match, cog, cog1, chn1, eng1, mat1))
mat <- mat0 %>% drop_na(c(score, conf, match, cog, cog1, chn1, eng1, mat1))
```


```{r}
# replace missing value on student covariates with homeroom mean
chn$age <- ifelse(!is.na(chn$age), chn$age, round(chn$hrage))
chn$only <- ifelse(!is.na(chn$only), chn$only, round(chn$hronly))
chn$rural <- ifelse(!is.na(chn$rural), chn$rural, round(chn$hrrural))
chn$migrant <- ifelse(!is.na(chn$migrant), chn$migrant, round(chn$hrmigrant))
chn$medu <- ifelse(!is.na(chn$medu), chn$medu, round(chn$hrmedu))
chn$fedu <- ifelse(!is.na(chn$fedu), chn$fedu, round(chn$hrfedu))
chn$income <- ifelse(!is.na(chn$income), chn$income, round(chn$hrincome))

eng$age <- ifelse(!is.na(eng$age), eng$age, round(eng$hrage))
eng$only <- ifelse(!is.na(eng$only), eng$only, round(eng$hronly))
eng$rural <- ifelse(!is.na(eng$rural), eng$rural, round(eng$hrrural))
eng$migrant <- ifelse(!is.na(eng$migrant), eng$migrant, round(eng$hrmigrant))
eng$medu <- ifelse(!is.na(eng$medu), eng$medu, round(eng$hrmedu))
eng$fedu <- ifelse(!is.na(eng$fedu), eng$fedu, round(eng$hrfedu))
eng$income <- ifelse(!is.na(eng$income), eng$income, round(eng$hrincome))

mat$age <- ifelse(!is.na(mat$age), mat$age, round(mat$hrage))
mat$only <- ifelse(!is.na(mat$only), mat$only, round(mat$hronly))
mat$rural <- ifelse(!is.na(mat$rural), mat$rural, round(mat$hrrural))
mat$migrant <- ifelse(!is.na(mat$migrant), mat$migrant, round(mat$hrmigrant))
mat$medu <- ifelse(!is.na(mat$medu), mat$medu, round(mat$hrmedu))
mat$fedu <- ifelse(!is.na(mat$fedu), mat$fedu, round(mat$hrfedu))
mat$income <- ifelse(!is.na(mat$income), mat$income, round(mat$hrincome))
```


```{r}
# replace missing value on teacher covariates with school mean
chn$advisor <- ifelse(!is.na(chn$advisor), chn$advisor, round(chn$schadvisor))
chn$tchexp <- ifelse(!is.na(chn$tchexp), chn$tchexp, round(chn$schexp))
chn$tchedu <- ifelse(!is.na(chn$tchedu), chn$tchedu, round(chn$schedu))

eng$advisor <- ifelse(!is.na(eng$advisor), eng$advisor, round(eng$schadvisor))
eng$tchexp <- ifelse(!is.na(eng$tchexp), eng$tchexp, round(eng$schexp))
eng$tchedu <- ifelse(!is.na(eng$tchedu), eng$tchedu, round(eng$schedu))

mat$advisor <- ifelse(!is.na(mat$advisor), mat$advisor, round(mat$schadvisor))
mat$tchexp <- ifelse(!is.na(mat$tchexp), mat$tchexp, round(mat$schexp))
mat$tchedu <- ifelse(!is.na(mat$tchedu), mat$tchedu, round(mat$schedu))
```

```{r, include = TRUE}
apply(chn, 2, na_percentage)
apply(eng, 2, na_percentage)
apply(mat, 2, na_percentage)
```

### Analytic sample descriptive stats


```{r, include = TRUE, results = "asis"}
descript <- function(data){
  data %>%
    select(match, tchfemale, female, score, conf) %>%
    tbl_summary(
      type = list(c("score", "conf") ~ "continuous",
                  c("match", "female", "tchfemale") ~ "dichotomous"),
      statistic = list(all_continuous() ~ "{mean} ({min}, {max})",
                       all_categorical() ~ "{n} / {N} ({p}%)"),
      label = list(match ~ "Teacher-student gender match",
                   tchfemale ~ "Female teacher",
                   female ~ "Female student",
                   score ~ "Score",
                   conf ~ "Confidence")
      )
}

descript(chn)
descript(eng)
descript(mat)
```

### Random assignment check


```{r}
add_f <- function(model){
  f <- summary(model)$P.fstat
  star <- case_when(
    f[4] >= 0.05 ~ "",
    f[4]<0.05 & f[4]>=0.01 ~ "*",
    f[4]<0.01 & f[4]>=0.001 ~ "**",
    f[4] < 0.001 ~ "***")
  paste(round(f[5], 3), star, " (df = ", f[3], "; ", f[6], ")", sep = "")
}  
```


```{r, include = TRUE, results = "asis"}
random <- function(data, var){
  felm(var ~ chn1 + eng1 + mat1 + cog1 + female + age + only + rural + migrant + medu + fedu + income | schids | 0 | schids, data)
}

labels <- c("Baseline Chinese",
            "Baseline English",
            "Baseline math",
            "Baseline cognitive",
            "Female student",
            "Age",
            "Only child",
            "Rural residency",
            "Migrant worker family",
            "Mother education (years)",
            "Father education (years)",
            "Family income")

c1 <- random(chn, chn$tchfemale)
c2 <- random(chn, chn$match)
c3 <- random(eng, eng$tchfemale)
c4 <- random(eng, eng$match)
c5 <- random(mat, mat$tchfemale)
c6 <- random(mat, mat$match)

stargazer(c1, c2, c3, c4, c5, c6,
          type = "html",
          omit = c("Constant"),
          dep.var.caption = "",
          dep.var.labels = "",
          covariate.labels = labels,
          model.numbers = TRUE,
          column.labels = c("Female teacher", "Matched gender", "Female teacher", "Matched gender", "Female teacher", "Matched gender"),
          star.cutoffs=c(0.05, 0.01, 0.001), 
          digits = 3, 
          flip = TRUE, 
          no.space = TRUE,
          notes.append=F, notes = c("*p$<$0.05, **p$<$0.01, ***p$<$0.001. Cells report coefficients and associated standard errors"),
          notes.align="l",
          add.lines = list(c("School Fixed Effects", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Clusterred SE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("F-Statistics", add_f(c1), add_f(c2), add_f(c3), add_f(c4), add_f(c5), add_f(c6))))

```


#### Missingness

Missing on teacher characteristics:

```{r}
# The most painful structure of baseline teacher data is that it's in wide format. 
# take tchfemale as an example, it is not one variable, it is four variables, hrc01 for teacher-advisor (TA), chnb01 for chinese teacher, engb01 for english teacher, and matb01 for math teacher. 
# one messed up thing is, if the TA teaches Chinese, chnb01 will be coded missing

tch_ta <- full_tch_1 %>% 
  filter(hra01 %in% c(1,2,3)) %>% #hra01, the subject the TA teaches, 1=mat, 2=chn, 3=eng, 0=other
  select(schids,
         clsids,
         tchfemale_ta = hrc01,
         tchexp_ta = hrc07,
         tchedu_ta = hrc04,
         subject = hra01) %>% 
  complete(clsids, subject)

tch_chn <- full_tch_1 %>% 
  select(schids,
         clsids,
         tchfemale3 = chnb01,
         tchexp3 = chnb07,
         tchedu3 = chnb04) %>% 
  mutate(subject = 2)

tch_eng <- full_tch_1 %>% 
  select(schids,
         clsids,
         tchfemale3 = engb01,
         tchexp3 = engb07,
         tchedu3 = engb04) %>% 
  mutate(subject = 3)

tch_mat <- full_tch_1 %>% 
  select(schids,
         clsids,
         tchfemale3 = matb01,
         tchexp3 = matb07,
         tchedu3 = matb04) %>% 
  mutate(subject = 1)

tch_subject <- rbind(tch_chn, tch_eng, tch_mat) 

tch_char <- full_join(tch_ta, tch_subject) %>% 
  ungroup() %>% 
  mutate(tchfemale = coalesce(tchfemale_ta, tchfemale3),
         tchexp = coalesce(tchexp_ta, tchexp3),
         tchedu = coalesce(tchedu_ta, tchedu3)) %>% 
  drop_na(schids, clsids) %>% 
  mutate(tchfemale = recode(tchfemale, '2' = 1, '1' = 0),
         tchedu = recode(tchedu, '1' = 9, '2' = 12, '3' = 12, '4' = 14, '5' = 16, '6' = 16, '7' = 19),
         tchgrad = ifelse(tchedu >= 19, 1, 0),
         tchnew = ifelse(tchexp <= 3, 1, 0))  %>% 
  ungroup() %>% 
  select(schids, clsids, subject, tchedu, tchgrad, tchexp, tchnew, tchfemale)

apply(tch_char, 2, na_percentage)
```

Missing on student academic performance and confidence:

```{r}
stu_chn <- full_stu_1 %>% 
  select(ids, schids, clsids,
         score = stdchn, # CEPS within school standardized score/mean = 70, sd = 10
         conf = c1102) %>% # confidence in learning chinese (c1103, english; c1101, math)
  mutate(score = (score-70)/10) %>% 
  group_by(schids) %>% 
  mutate(conf = nmlz(conf)) %>% 
  ungroup() %>% 
  mutate(subject = 2)

stu_eng <- full_stu_1 %>% 
  select(ids, schids, clsids,
         score = stdeng, 
         conf = c1103) %>% 
  mutate(score = (score-70)/10) %>% 
  group_by(schids) %>% 
  mutate(conf = nmlz(conf)) %>% 
  ungroup() %>% 
  mutate(subject = 3)

stu_mat <- full_stu_1 %>% 
  select(ids, schids, clsids,
         score = stdmat, 
         conf = c1101) %>%
  mutate(score = (score-70)/10) %>% 
  group_by(schids) %>% 
  mutate(conf = nmlz(conf)) %>% 
  ungroup() %>%  
  mutate(subject = 1)

stu_aca <- rbind(stu_chn, stu_eng, stu_mat)

apply(stu_aca, 2, na_percentage)
```

Missing on student characteristics:

```{r}
stu_char <- full_stu_1 %>% 
  select(ids, schids, clsids, grade9, fall,
         cog = cog3pl, # CEPS full sample standardized score/mean = 0, sd = 1
         female = stsex,
         birthyear= a02a, # 405 is missing
         birthmonth = a02b,
         only = stonly,
         rural = sthktype, 
         migrant = stmigrant, 
         medu = stmedu, 
         fedu = stfedu,
         income = steco_3c) %>% 
  mutate(birthyear = ifelse(birthyear == 2020, 2002, birthyear),
         birthmonth = ifelse(is.na(birthmonth), 1, birthmonth)) %>%
  mutate(birth = ym(paste(birthyear, birthmonth, sep = "-")),
         entry = ym("2013-9"),
         age = floor(decimal_date(entry) - decimal_date(birth)), 
         female = recode(female, '1' = 0, '0' = 1),
         only = recode(only,'1' = 1, '2' = 0),
         migrant = recode(migrant,'1' = 0, '2' = 1, '3' = 1),
         medu = recode(medu, '1' = 0, '2' = 6, '3' = 9, '4' = 12, '5' = 12, '6' = 12, '7' = 14, '8' = 16, '9' = 19),
         fedu = recode(fedu, '1' = 0, '2' = 6, '3' = 9, '4' = 12, '5' = 12, '6' = 12, '7' = 14, '8' = 16, '9' = 19),
         income = recode(income, '1' = 0, '2' = 1, '3' = 2)) %>% 
  group_by(clsids) %>% 
  mutate(hrsize = n(),
         hrfemale = mymean(female),
         hrage = mymean(age),
         hronly = mymean(only),
         hrrural = mymean(rural),
         hrmigrant = mymean(migrant),
         hrmedu = mymean(medu),
         hrfedu = mymean(fedu),
         hrincome = mymean(income)) %>% 
  ungroup() %>% 
  select(-birthyear, -birthmonth, -entry, -birth)

apply(stu_char, 2, na_percentage)
```


Missing after match teacher and student data

```{r}
char0 <- left_join(full_join(stu_aca, stu_char), tch_char) %>% 
  ungroup() %>% 
  mutate(match = ifelse(female == tchfemale, 1, 0))

apply(char0, 2, na_percentage)

char <- char0 %>% 
  drop_na()
```

#### Descriptive stats

Table 1. Descriptive statistics of key variables

```{r}
char %>% 
  select(tchedu, tchgrad, tchexp, tchnew, tchfemale, female, match, score, conf) %>% 
  tbl_summary(
    type = list(c("tchedu", "tchexp", "score", "conf") ~ "continuous",
                c("tchgrad", "tchnew", "tchfemale", "match", "female") ~ "dichotomous"),
    statistic = list(all_continuous() ~ "{mean} ({min}, {max})",
                     all_categorical() ~ "{n} / {N} ({p}%)"),
    label = list(tchedu ~ "Teacher education (years)",
                 tchgrad ~ "Graduate degree",
                 tchexp ~ "Teacher experience (years)",
                 tchnew ~ "Novice teacher (less than 3Y)",
                 tchfemale ~ "Female teacher",
                 match ~ "Teacher-student gender match",
                 female ~ "Female student",
                 score ~ "Student academic performance",
                 conf ~ "Student academic confidence")
  )
```

#### Covariates balance

```{r, include = TRUE, results = "asis"}
add_f <- function(model){
  f <- summary(model)$P.fstat
  star <- case_when(
    f[4] >= 0.05 ~ "",
    f[4]<0.05 & f[4]>=0.01 ~ "*",
    f[4]<0.01 & f[4]>=0.001 ~ "**",
    f[4] < 0.001 ~ "***")
  paste(round(f[5], 3), star, " (df = ", f[3], "; ", f[6], ")", sep = "")
}  


random <- function(var){
  felm(var ~ cog + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)
}

labels <- c("Cognitive Score",
            "Female student",
            "Age",
            "Only child",
            "Rural residency",
            "Migrant worker family",
            "Mother education (years)",
            "Father education (years)",
            "Family income")

c1 <- random(char$tchedu)
c2 <- random(char$tchgrad)
c3 <- random(char$tchexp)
c4 <- random(char$tchnew)
c5 <- random(char$tchfemale)
c6 <- random(char$match)
c7 <- random(char$score)
c8 <- random(char$conf)


stargazer(c1, c2, c3, c4, c5, c6, c7, c8,
          type = "html",
          omit = c("Constant"),
          dep.var.caption = "",
          dep.var.labels = "",
          covariate.labels = labels,
          model.numbers = FALSE,
          column.labels = c("Teacher education (years)", "Graduate degree", "Teacher experience (years)", "Novice teacher (less than 3Y)", "Female teacher", "Teacher-student gender match", "Student academic performance", "Student academic confidence"),
          star.cutoffs=c(0.05, 0.01, 0.001), 
          digits = 3, 
          flip = TRUE, 
          no.space = TRUE,
          notes.append=F, notes = c("*p$<$0.05, **p$<$0.01, ***p$<$0.001. Cells report coefficients and associated standard errors"),
          notes.align="l",
          add.lines = list(c("School FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Grade FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Subject FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Classroom clustered SE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("F-Statistics", add_f(c1), add_f(c2), add_f(c3), add_f(c4), add_f(c5), add_f(c6), add_f(c7), add_f(c8))))


```


#### Teacher educational background on student outcomes

```{r, include = TRUE, results = "asis"}
m1 <- felm(score ~ tchedu + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)

m2 <- felm(score ~ tchedu + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income + hrsize + hrfemale + hrage + hronly + hrrural + hrmigrant + hrmedu + hrfedu + hrincome | schids + grade9 + subject | 0 | clsids, char)

m3 <- felm(score ~ tchgrad + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)

m4 <- felm(score ~ tchgrad + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income + hrsize + hrfemale + hrage + hronly + hrrural + hrmigrant + hrmedu + hrfedu + hrincome | schids + grade9 + subject | 0 | clsids, char)

m5 <- felm(conf ~ tchedu + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)

m6 <- felm(conf ~ tchedu + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income + hrsize + hrfemale + hrage + hronly + hrrural + hrmigrant + hrmedu + hrfedu + hrincome | schids + grade9 + subject | 0 | clsids, char)

m7 <- felm(conf ~ tchgrad + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)

m8 <- felm(conf ~ tchgrad + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income + hrsize + hrfemale + hrage + hronly + hrrural + hrmigrant + hrmedu + hrfedu + hrincome | schids + grade9 + subject | 0 | clsids, char)


stargazer(m1, m2, m3, m4, m5, m6, m7, m8,
          type = "html",
          omit = c("Constant"),
          keep = c("\\btchedu\\b", "\\btchgrad\\b"),
          model.numbers = FALSE,
          dep.var.caption = "",
          dep.var.labels = c("", ""),
          column.labels = c("Performance", "Performance", "Performance", "Performance", "Confidence", "Confidence", "Confidence", "Confidence"),
          star.cutoffs=c(0.05, 0.01, 0.001), 
          digits = 3, 
          flip = TRUE, 
          no.space = TRUE,
          notes.append=F, notes = c("*p$<$0.05, **p$<$0.01, ***p$<$0.001. Cells report coefficients and associated standard errors"),
          notes.align="l",
          add.lines = list(c("Student Covariates", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Homeroom Covariates", "No", "Yes", "No", "Yes", "No", "Yes", "No", "Yes"),
                           c("School FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Grade FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Subject FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Classroom clustered SE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes")))

```

#### Teacher experience on student outcomes

```{r, include = TRUE, results = "asis"}
m1 <- felm(score ~ tchexp + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)

m2 <- felm(score ~ tchexp + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income + hrsize + hrfemale + hrage + hronly + hrrural + hrmigrant + hrmedu + hrfedu + hrincome | schids + grade9 + subject | 0 | clsids, char)

m3 <- felm(score ~ tchnew + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)

m4 <- felm(score ~ tchnew + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income + hrsize + hrfemale + hrage + hronly + hrrural + hrmigrant + hrmedu + hrfedu + hrincome | schids + grade9 + subject | 0 | clsids, char)

m5 <- felm(conf ~ tchexp + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)

m6 <- felm(conf ~ tchexp + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income + hrsize + hrfemale + hrage + hronly + hrrural + hrmigrant + hrmedu + hrfedu + hrincome | schids + grade9 + subject | 0 | clsids, char)

m7 <- felm(conf ~ tchnew + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income | schids + grade9 + subject | 0 | clsids, char)

m8 <- felm(conf ~ tchnew + poly(cog, 3) + female + age + only + rural + migrant + medu + fedu + income + hrsize + hrfemale + hrage + hronly + hrrural + hrmigrant + hrmedu + hrfedu + hrincome | schids + grade9 + subject | 0 | clsids, char)


stargazer(m1, m2, m3, m4, m5, m6, m7, m8,
          type = "html",
          keep = c("\\btchexp\\b", "\\btchnew\\b"),
          model.numbers = FALSE,
          dep.var.caption = "",
          dep.var.labels = c("", ""),
          column.labels = c("Performance", "Performance", "Performance", "Performance", "Confidence", "Confidence", "Confidence", "Confidence"),
          star.cutoffs=c(0.05, 0.01, 0.001), 
          digits = 3, 
          flip = TRUE, 
          no.space = TRUE,
          notes.append=F, notes = c("*p$<$0.05, **p$<$0.01, ***p$<$0.001. Cells report coefficients and associated standard errors"),
          notes.align="l",
          add.lines = list(c("Student Covariates", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Homeroom Covariates", "No", "Yes", "No", "Yes", "No", "Yes", "No", "Yes"),
                           c("School FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Grade FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Subject FE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes"),
                           c("Classroom clustered SE", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes")))

```


